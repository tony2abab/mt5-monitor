# 交易時段與周末配置說明

## 📁 配置文件位置

**主要文件：**
- `D:\OneDrive - VW\CascadeProjects\MT5_Monitor\mql\A計算盈虧_r9a_webmonitor.mq5` (MT5 版本)
- `D:\OneDrive - VW\CascadeProjects\MT5_Monitor\mql\A計算盈虧_r9a_webmonitor.mq4` (MT4 版本)

---

## ⚙️ 主要配置參數

### 1. 交易時段配置（倫敦時間）

在 EA 參數區域（文件開頭）：

```mql5
input int Step4_IC時 = 23;           // 交易時段開始-小時（倫敦時間）
input int Step4_IC分_0to58 = 33;     // 交易時段開始-分鐘
```

**說明：**
- 這些參數控制交易時段的開始時間
- 默認值：23:33（倫敦時間）
- 可以在 MT5 EA 屬性中直接修改，無需重新編譯

### 2. 周末休市配置

在代碼中（約第 289 行）：

```mql5
bool week_enable1111111S4_時_變數Step4_IC分_0to58S4_時_變數S4_分加一[7] = {true, true, true, true, true, true, true};
```

**數組索引對應：**
- `[0]` = 星期日 (Sunday)
- `[1]` = 星期一 (Monday)
- `[2]` = 星期二 (Tuesday)
- `[3]` = 星期三 (Wednesday)
- `[4]` = 星期四 (Thursday)
- `[5]` = 星期五 (Friday)
- `[6]` = 星期六 (Saturday)

---

## 🛠️ 配置示例

### 示例 1：周末休市（周一至周五交易）

```mql5
// 修改這一行：
bool week_enable1111111S4_時_變數Step4_IC分_0to58S4_時_變數S4_分加一[7] = {false, true, true, true, true, true, false};
//                                                                      日     一    二    三    四    五    六
```

### 示例 2：只在周一、周三、周五交易

```mql5
bool week_enable1111111S4_時_變數Step4_IC分_0to58S4_時_變數S4_分加一[7] = {false, true, false, true, false, true, false};
//                                                                      日     一    二     三    四     五    六
```

### 示例 3：全周交易（包括周末）

```mql5
bool week_enable1111111S4_時_變數Step4_IC分_0to58S4_時_變數S4_分加一[7] = {true, true, true, true, true, true, true};
//                                                                      日    一    二    三    四    五    六
```

---

## 🕐 倫敦時間與服務器時間轉換

### 重要提示

MT5 使用的是**經紀商服務器時間**，不是倫敦時間！

**常見時區差異：**
- 如果服務器是 GMT+2（夏令時）：倫敦時間 + 1 小時 = 服務器時間
- 如果服務器是 GMT+3（冬令時）：倫敦時間 + 2 小時 = 服務器時間
- 如果服務器是 GMT+0：倫敦時間 = 服務器時間

### 轉換示例

**目標：倫敦時間 08:00 開始交易**

1. 查看 MT5 服務器時區（Market Watch → 右鍵 → Symbols → 查看時間）
2. 計算時差：
   - 服務器 GMT+2：設置 `Step4_IC時 = 9`（8 + 1）
   - 服務器 GMT+3：設置 `Step4_IC時 = 10`（8 + 2）
   - 服務器 GMT+0：設置 `Step4_IC時 = 8`

---

## 📝 修改步驟

### 方法 1：修改源代碼（需要重新編譯）

1. **打開文件**
   ```
   D:\OneDrive - VW\CascadeProjects\MT5_Monitor\mql\A計算盈虧_r9a_webmonitor.mq5
   ```

2. **修改周末配置**（約第 289 行）
   ```mql5
   bool week_enable1111111S4_時_變數Step4_IC分_0to58S4_時_變數S4_分加一[7] = {false, true, true, true, true, true, false};
   ```

3. **修改交易時段**（文件開頭的 input 區域）
   ```mql5
   input int Step4_IC時 = 8;           // 改為 8:00
   input int Step4_IC分_0to58 = 0;
   ```

4. **保存並重新編譯**
   - 在 MT5 MetaEditor 中按 F7 編譯
   - 或使用菜單：Compile → Compile

5. **重新加載 EA**
   - 在 MT5 圖表上移除舊 EA
   - 重新拖入新編譯的 EA

### 方法 2：通過 EA 參數設置（僅限 input 參數）

1. **在 MT5 圖表上右鍵點擊 EA**
2. **選擇「EA 交易」→「屬性」**
3. **在「輸入參數」標籤中修改：**
   - `Step4_IC時` = 8（開始小時）
   - `Step4_IC分_0to58` = 0（開始分鐘）
4. **點擊「確定」**

**注意：** `week_enable` 數組無法通過參數修改，必須修改源代碼！

---

## 🔍 時間檢查函數

EA 使用以下函數檢查當前時間是否在交易時段內：

```mql5
bool Check_TimeSession(
    bool &weekday_enable[],    // 星期啟用數組
    int aStartHour,            // 開始小時
    int aStartMinute,          // 開始分鐘
    int aStopHour,             // 結束小時
    int aStopMinute,           // 結束分鐘
    datetime aTimeCur          // 當前時間
)
```

**功能：**
1. 檢查當前是星期幾
2. 檢查該星期是否啟用（`weekday_enable[day_of_week]`）
3. 檢查當前時間是否在指定時段內
4. 返回 `true` 表示可以交易，`false` 表示休市

---

## ✅ 推薦配置

### 標準外匯交易時段（周一至周五）

```mql5
// 周末休市
bool week_enable1111111S4_時_變數Step4_IC分_0to58S4_時_變數S4_分加一[7] = {false, true, true, true, true, true, false};

// 倫敦時間 00:00 開始（全天交易）
input int Step4_IC時 = 0;
input int Step4_IC分_0to58 = 0;
```

### 僅倫敦交易時段（08:00-17:00）

```mql5
// 周末休市
bool week_enable1111111S4_時_變數Step4_IC分_0to58S4_時_變數S4_分加一[7] = {false, true, true, true, true, true, false};

// 倫敦時間 08:00 開始
input int Step4_IC時 = 8;
input int Step4_IC分_0to58 = 0;

// 需要在代碼中添加結束時間檢查
// 或使用 Check_TimeSession 函數的完整參數
```

---

## ⚠️ 注意事項

1. **時區差異**
   - 務必確認服務器時區
   - 根據時差調整時間參數

2. **夏令時**
   - 某些經紀商會調整服務器時間
   - 夏令時期間可能需要調整參數

3. **周末休市**
   - 外匯市場周末休市（周六、日）
   - 加密貨幣市場 24/7 交易

4. **重新編譯**
   - 修改 `week_enable` 數組後必須重新編譯
   - 修改 `input` 參數可以在 EA 屬性中直接修改

5. **測試**
   - 修改後先在模擬賬戶測試
   - 確認時間邏輯正確後再用於實盤

---

## 📞 技術支持

如有問題，請檢查：
1. MT5 Expert 日誌
2. 服務器時間顯示
3. EA 參數設置
4. 源代碼編譯錯誤

---

**最後更新：** 2025-11-27
