<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–®æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #0B1221;
            color: #fff;
        }
        .card {
            background: #16213e;
            border: 1px solid #00F0FF;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .status { 
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
        }
        .online { background: #00FF88; color: #000; }
        .offline { background: #ff4444; color: #fff; }
        .data { 
            display: flex; 
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
    </style>
</head>
<body>
    <h1 style="color: #00F0FF;">ğŸš€ MT5 ç›£æ§ç³»çµ±</h1>
    
    <div id="nodes-container">
        <p>æ­£åœ¨è¼‰å…¥...</p>
    </div>

    <script>
        async function loadData() {
            try {
                console.log('é–‹å§‹è¼‰å…¥æ•¸æ“š...');
                const response = await fetch('/api/nodes');
                console.log('HTTPç‹€æ…‹:', response.status);
                
                const data = await response.json();
                console.log('æ”¶åˆ°æ•¸æ“š:', data);
                
                const container = document.getElementById('nodes-container');
                
                if (data.ok && data.nodes.length > 0) {
                    let html = '';
                    
                    data.nodes.forEach(node => {
                        const statusClass = node.status === 'online' ? 'online' : 'offline';
                        const stats = node.todayABStats;
                        
                        html += `
                            <div class="card">
                                <h2>${node.name} <span class="status ${statusClass}">${node.status}</span></h2>
                                <p>ID: ${node.id} | å¸³è™Ÿ: ${node.account}</p>
                                <p>ç¶“ç´€å•†: ${node.broker}</p>
                                <p>æœ€å¾Œå¿ƒè·³: ${node.lastHeartbeatRelative}</p>
                        `;
                        
                        if (stats) {
                            html += `
                                <h3 style="color: #00F0FF; margin-top: 20px;">ğŸ“Š ä»Šæ—¥ A/B çµ±è¨ˆ</h3>
                                <div class="data">
                                    <span>Aæ‰‹æ•¸:</span>
                                    <span style="color: #00F0FF;">${stats.a_lots_total?.toFixed(2) ?? '0.00'}</span>
                                </div>
                                <div class="data">
                                    <span>Bæ‰‹æ•¸:</span>
                                    <span style="color: #8A2BE2;">${stats.b_lots_total?.toFixed(2) ?? '0.00'}</span>
                                </div>
                                <div class="data">
                                    <span>æ‰‹æ•¸å·®:</span>
                                    <span style="color: ${(stats.lots_diff ?? 0) !== 0 ? '#ff4444' : '#fff'};">
                                        ${stats.lots_diff >= 0 ? '+' : ''}${stats.lots_diff?.toFixed(2) ?? '0.00'}
                                    </span>
                                </div>
                                <div class="data">
                                    <span>Aç›ˆåˆ©:</span>
                                    <span style="color: ${(stats.a_profit_total ?? 0) >= 0 ? '#00FF88' : '#ff4444'};">
                                        ${(stats.a_profit_total ?? 0) >= 0 ? '+' : ''}$${stats.a_profit_total?.toFixed(2) ?? '0.00'}
                                    </span>
                                </div>
                                <div class="data">
                                    <span>Bç›ˆåˆ©:</span>
                                    <span style="color: ${(stats.b_profit_total ?? 0) >= 0 ? '#00FF88' : '#ff4444'};">
                                        ${(stats.b_profit_total ?? 0) >= 0 ? '+' : ''}$${stats.b_profit_total?.toFixed(2) ?? '0.00'}
                                    </span>
                                </div>
                                <div class="data" style="border-bottom: none; font-weight: bold; font-size: 16px;">
                                    <span style="color: #FFD700;">ABç¸½ç›ˆåˆ©:</span>
                                    <span style="color: ${(stats.ab_profit_total ?? 0) >= 0 ? '#00FF88' : '#ff4444'};">
                                        ${(stats.ab_profit_total ?? 0) >= 0 ? '+' : ''}$${stats.ab_profit_total?.toFixed(2) ?? '0.00'}
                                    </span>
                                </div>
                                <div class="data" style="border-bottom: none;">
                                    <span>æ¯æ‰‹æˆæœ¬:</span>
                                    <span style="color: #FFFF00;">$${stats.cost_per_lot?.toFixed(2) ?? '0.00'}</span>
                                </div>
                                <div class="data" style="border-bottom: none;">
                                    <span>Aç¸½æ¯:</span>
                                    <span>${stats.a_interest_total?.toFixed(2) ?? '0.00'}</span>
                                </div>
                            `;
                        } else {
                            html += '<p style="color: #888;">å°šç„¡çµ±è¨ˆæ•¸æ“š</p>';
                        }
                        
                        html += '</div>';
                    });
                    
                    container.innerHTML = html;
                    console.log('âœ… æ•¸æ“šé¡¯ç¤ºæˆåŠŸï¼');
                } else {
                    container.innerHTML = '<div class="card"><p style="color: #ff4444;">ç„¡ç¯€é»æ•¸æ“š</p></div>';
                }
            } catch (error) {
                console.error('âŒ éŒ¯èª¤:', error);
                document.getElementById('nodes-container').innerHTML = 
                    `<div class="card"><p style="color: #ff4444;">éŒ¯èª¤: ${error.message}</p></div>`;
            }
        }
        
        // é é¢è¼‰å…¥å¾ŒåŸ·è¡Œ
        loadData();
        
        // æ¯10ç§’è‡ªå‹•åˆ·æ–°
        setInterval(loadData, 10000);
    </script>
</body>
</html>
